# Story 1.3: 프로젝트 CRUD 관리 시스템

## 📋 문서 정보
- **스토리 버전**: 2.0
- **작성일**: 2025-08-27
- **작성자**: Bob (Scrum Master Agent)
- **프로젝트명**: 바로캘린더 (Baro Calendar)
- **Epic**: 프론트엔드 핵심 기능 구현
- **상태**: Ready for Development

---

## 🎯 **스토리 목표**

**완전한 프로젝트 관리 시스템 구축**
- 8색상 팔레트 기반 프로젝트 색상 시스템
- Apollo Client + Zustand 기반 실시간 상태 관리
- 드래그 앤 드롭을 통한 직관적 프로젝트 관리
- WCAG 2.2 AA 접근성 및 JWT 보안 적용
- 성능 최적화 및 모니터링 통합

---

## 👤 **사용자 스토리**

**프로젝트 관리자로서, 나는:**
1. 8색상 팔레트로 시각적으로 구분되는 프로젝트를 생성하고 관리하고 싶다
2. 드래그 앤 드롭으로 프로젝트 순서를 변경하고 싶다
3. 실시간으로 팀원들과 프로젝트 변경사항을 공유하고 싶다
4. 프로젝트별 권한을 세밀하게 관리하고 싶다
5. 모바일에서도 완벽하게 프로젝트를 관리하고 싶다

---

## 🏗️ **기술적 구현 요구사항**

### **1. ShadCN UI + MCP Server 컴포넌트 시스템**

**핵심 블록 사용**
```typescript
// 필수 MCP 서버 명령어 시퀀스
// 1. 프로젝트 관리 대시보드
npx shadcn@latest add dashboard-01
npx shadcn@latest add sidebar-02

// 2. 프로젝트 카드 및 폼
npx shadcn@latest add cards-01
npx shadcn@latest add forms-01

// 3. 데이터 테이블 및 모달
npx shadcn@latest add table-01
npx shadcn@latest add modal-01

// 개별 컴포넌트
npx shadcn@latest add dialog
npx shadcn@latest add form
npx shadcn@latest add input
npx shadcn@latest add select
npx shadcn@latest add badge
npx shadcn@latest add dropdown-menu
npx shadcn@latest add toast
npx shadcn@latest add avatar
npx shadcn@latest add button
```

### **2. 8색상 팔레트 프로젝트 시스템**

**색상 매핑 및 관리**
```typescript
// src/types/project.ts
export const PROJECT_COLORS = {
  red: { 
    primary: 'hsl(0 84% 60%)', 
    secondary: 'hsl(0 84% 95%)',
    name: '빨강' 
  },
  orange: { 
    primary: 'hsl(25 95% 53%)', 
    secondary: 'hsl(25 95% 95%)',
    name: '주황' 
  },
  amber: { 
    primary: 'hsl(45 93% 47%)', 
    secondary: 'hsl(45 93% 95%)',
    name: '호박' 
  },
  yellow: { 
    primary: 'hsl(60 84% 67%)', 
    secondary: 'hsl(60 84% 95%)',
    name: '노랑' 
  },
  lime: { 
    primary: 'hsl(75 85% 60%)', 
    secondary: 'hsl(75 85% 95%)',
    name: '연두' 
  },
  green: { 
    primary: 'hsl(120 84% 60%)', 
    secondary: 'hsl(120 84% 95%)',
    name: '초록' 
  },
  blue: { 
    primary: 'hsl(210 84% 60%)', 
    secondary: 'hsl(210 84% 95%)',
    name: '파랑' 
  },
  purple: { 
    primary: 'hsl(270 84% 60%)', 
    secondary: 'hsl(270 84% 95%)',
    name: '보라' 
  },
} as const

export type ProjectColor = keyof typeof PROJECT_COLORS

export interface Project {
  id: string
  name: string
  description?: string
  color: ProjectColor
  isActive: boolean
  members: ProjectMember[]
  permissions: ProjectPermissions
  createdAt: string
  updatedAt: string
  order: number
}
```

### **3. Apollo Client + Zustand 상태 관리**

**GraphQL 스키마 및 쿼리**
```typescript
// src/graphql/project.graphql
query GetProjects($filters: ProjectFilters) {
  projects(filters: $filters) {
    id
    name
    description
    color
    isActive
    members {
      userId
      role
      permissions
    }
    createdAt
    updatedAt
    order
  }
}

mutation CreateProject($input: CreateProjectInput!) {
  createProject(input: $input) {
    id
    name
    color
    order
  }
}

mutation UpdateProject($id: ID!, $input: UpdateProjectInput!) {
  updateProject(id: $id, input: $input) {
    id
    name
    description
    color
    isActive
    order
  }
}

mutation DeleteProject($id: ID!) {
  deleteProject(id: $id) {
    success
    message
  }
}

subscription ProjectUpdates {
  projectUpdated {
    id
    type # CREATED, UPDATED, DELETED
    project {
      id
      name
      color
      order
    }
  }
}
```

**Zustand Store 통합**
```typescript
// src/stores/projectStore.ts
interface ProjectState {
  // 상태
  projects: Project[]
  selectedProject: Project | null
  isLoading: boolean
  error: ApiError | null
  
  // 필터 및 정렬
  sortBy: 'name' | 'createdAt' | 'order'
  sortDirection: 'asc' | 'desc'
  activeOnly: boolean
  
  // Actions
  setProjects: (projects: Project[]) => void
  addProject: (project: Project) => void
  updateProject: (id: string, updates: Partial<Project>) => void
  deleteProject: (id: string) => void
  selectProject: (project: Project | null) => void
  reorderProjects: (fromIndex: number, toIndex: number) => void
  
  // Apollo 통합
  refetch: () => Promise<void>
  optimisticUpdate: (id: string, updates: Partial<Project>) => void
}

export const useProjectStore = create<ProjectState>((set, get) => ({
  projects: [],
  selectedProject: null,
  isLoading: false,
  error: null,
  sortBy: 'order',
  sortDirection: 'asc',
  activeOnly: false,
  
  setProjects: (projects) => set({ projects }),
  
  addProject: (project) => 
    set((state) => ({ 
      projects: [...state.projects, project] 
    })),
    
  updateProject: (id, updates) =>
    set((state) => ({
      projects: state.projects.map(p => 
        p.id === id ? { ...p, ...updates } : p
      )
    })),
    
  reorderProjects: (fromIndex, toIndex) => {
    const { projects } = get()
    const newProjects = [...projects]
    const [removed] = newProjects.splice(fromIndex, 1)
    newProjects.splice(toIndex, 0, removed)
    
    // 순서 업데이트
    const updatedProjects = newProjects.map((project, index) => ({
      ...project,
      order: index
    }))
    
    set({ projects: updatedProjects })
  },
}))
```

### **4. 실시간 WebSocket 동기화**

**프로젝트 실시간 업데이트**
```typescript
// src/hooks/useProjectRealtime.ts
export const useProjectRealtime = () => {
  const { projects, addProject, updateProject, deleteProject } = useProjectStore()
  
  const { data, error } = useSubscription(PROJECT_UPDATES_SUBSCRIPTION, {
    onSubscriptionData: ({ subscriptionData }) => {
      const { type, project } = subscriptionData.data.projectUpdated
      
      switch (type) {
        case 'CREATED':
          addProject(project)
          showToast('success', `새 프로젝트 "${project.name}"가 생성되었습니다`)
          break
          
        case 'UPDATED':
          updateProject(project.id, project)
          showToast('info', `프로젝트 "${project.name}"가 업데이트되었습니다`)
          break
          
        case 'DELETED':
          deleteProject(project.id)
          showToast('warning', `프로젝트 "${project.name}"가 삭제되었습니다`)
          break
      }
    }
  })
  
  return { error }
}
```

### **5. 드래그 앤 드롭 구현**

**React DnD 통합**
```typescript
// src/components/project/ProjectList.tsx
import { DndProvider } from 'react-dnd'
import { HTML5Backend } from 'react-dnd-html5-backend'
import { TouchBackend } from 'react-dnd-touch-backend'

const ProjectList = () => {
  const { projects, reorderProjects } = useProjectStore()
  const isMobile = useMediaQuery('(max-width: 768px)')
  
  const handleDrop = useCallback((dragIndex: number, dropIndex: number) => {
    reorderProjects(dragIndex, dropIndex)
    
    // 서버 동기화
    updateProjectOrderMutation({
      variables: {
        updates: projects.map((project, index) => ({
          id: project.id,
          order: index
        }))
      }
    })
  }, [projects, reorderProjects])
  
  return (
    <DndProvider backend={isMobile ? TouchBackend : HTML5Backend}>
      <div className="project-list space-y-2">
        {projects.map((project, index) => (
          <DraggableProjectCard
            key={project.id}
            project={project}
            index={index}
            onDrop={handleDrop}
          />
        ))}
      </div>
    </DndProvider>
  )
}
```

### **6. 성능 최적화**

**가상화 및 메모이제이션**
```typescript
// src/components/project/VirtualizedProjectList.tsx
import { FixedSizeList as List } from 'react-window'

const VirtualizedProjectList = () => {
  const { projects } = useProjectStore()
  
  const ProjectItem = memo(({ index, style }: ListChildComponentProps) => {
    const project = projects[index]
    
    return (
      <div style={style}>
        <ProjectCard project={project} />
      </div>
    )
  })
  
  return (
    <List
      height={600}
      itemCount={projects.length}
      itemSize={80}
      overscanCount={5}
    >
      {ProjectItem}
    </List>
  )
}

// 프로젝트 카드 메모이제이션
const ProjectCard = memo(({ project }: { project: Project }) => {
  const colorConfig = PROJECT_COLORS[project.color]
  
  return (
    <div 
      className="project-card"
      style={{
        '--project-primary': colorConfig.primary,
        '--project-secondary': colorConfig.secondary,
      }}
    >
      <div className="flex items-center gap-3 p-4">
        <div 
          className="w-4 h-4 rounded-full"
          style={{ backgroundColor: colorConfig.primary }}
          role="img"
          aria-label={`프로젝트 색상: ${colorConfig.name}`}
        />
        <span className="font-medium">{project.name}</span>
        <Badge variant="secondary" className="ml-auto">
          {project.members.length}명
        </Badge>
      </div>
    </div>
  )
}, (prevProps, nextProps) => {
  return (
    prevProps.project.id === nextProps.project.id &&
    prevProps.project.name === nextProps.project.name &&
    prevProps.project.color === nextProps.project.color &&
    prevProps.project.members.length === nextProps.project.members.length
  )
})
```

---

## 🎨 **사용자 경험 (UX) 설계**

### **1. 프로젝트 생성 플로우**

**색상 선택 인터페이스**
```typescript
// src/components/project/ColorPicker.tsx
const ColorPicker = ({ value, onChange }: ColorPickerProps) => {
  return (
    <div className="color-picker grid grid-cols-4 gap-2 p-4">
      {Object.entries(PROJECT_COLORS).map(([key, config]) => (
        <button
          key={key}
          className={cn(
            "w-12 h-12 rounded-full border-2 transition-all",
            "hover:scale-110 focus-visible:ring-2 focus-visible:ring-offset-2",
            value === key ? "border-foreground scale-110" : "border-transparent"
          )}
          style={{ backgroundColor: config.primary }}
          onClick={() => onChange(key as ProjectColor)}
          aria-label={`색상 선택: ${config.name}`}
          aria-pressed={value === key}
        >
          {value === key && (
            <Check className="w-6 h-6 text-white mx-auto" />
          )}
        </button>
      ))}
    </div>
  )
}
```

### **2. 접근성 (A11y) 구현**

**WCAG 2.2 AA 준수**
```typescript
// 색상 대비 검증
const validateColorContrast = (backgroundColor: string, textColor: string): boolean => {
  const contrast = calculateContrast(backgroundColor, textColor)
  return contrast >= 4.5 // WCAG AA 기준
}

// 키보드 네비게이션
const useKeyboardNavigation = () => {
  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      switch (event.key) {
        case 'ArrowDown':
          event.preventDefault()
          selectNextProject()
          break
        case 'ArrowUp':
          event.preventDefault()
          selectPreviousProject()
          break
        case 'Enter':
        case ' ':
          event.preventDefault()
          openSelectedProject()
          break
      }
    }
    
    document.addEventListener('keydown', handleKeyDown)
    return () => document.removeEventListener('keydown', handleKeyDown)
  }, [])
}

// 스크린 리더 지원
<div
  role="region"
  aria-label="프로젝트 목록"
  aria-describedby="project-help"
>
  <div id="project-help" className="sr-only">
    화살표 키로 프로젝트를 선택하고, 엔터키로 열 수 있습니다.
  </div>
</div>
```

### **3. 모바일 최적화**

**터치 친화적 인터페이스**
```typescript
// 44px 최소 터치 영역
const ProjectMobileCard = ({ project }: ProjectMobileCardProps) => {
  return (
    <div className="min-h-[44px] p-3 touch-manipulation">
      <SwipeToAction
        leftActions={[
          {
            label: '편집',
            icon: <Edit className="w-5 h-5" />,
            color: 'blue',
            onAction: () => editProject(project.id)
          }
        ]}
        rightActions={[
          {
            label: '삭제',
            icon: <Trash className="w-5 h-5" />,
            color: 'red',
            onAction: () => deleteProject(project.id)
          }
        ]}
      >
        <ProjectCard project={project} />
      </SwipeToAction>
    </div>
  )
}
```

---

## 🔒 **보안 구현**

### **JWT 기반 권한 관리**
```typescript
// src/lib/auth/permissions.ts
export const PROJECT_PERMISSIONS = {
  READ: 'project:read',
  WRITE: 'project:write',
  DELETE: 'project:delete',
  MANAGE_MEMBERS: 'project:manage_members',
} as const

export const checkProjectPermission = (
  project: Project, 
  permission: string, 
  user: User
): boolean => {
  const member = project.members.find(m => m.userId === user.id)
  if (!member) return false
  
  return member.permissions.includes(permission)
}

// GraphQL 쿼리에 권한 체크 포함
const GET_PROJECTS = gql`
  query GetProjects {
    projects @auth(requires: [PROJECT_READ]) {
      id
      name
      color
      permissions @include(if: $includePermissions)
    }
  }
`
```

---

## 📊 **성능 메트릭 및 모니터링**

### **성능 임계치**
```typescript
// src/lib/monitoring/projectMetrics.ts
export const PROJECT_PERFORMANCE_TARGETS = {
  // 프로젝트 목록 로딩
  projectListLoad: 800, // 800ms
  
  // 프로젝트 생성
  projectCreation: 1200, // 1.2초
  
  // 드래그 앤 드롭 응답성
  dragResponse: 16, // 60fps = 16ms
  
  // 색상 변경 애니메이션
  colorTransition: 150, // 150ms
}

export const trackProjectMetrics = () => {
  // 프로젝트 로딩 시간 측정
  performance.mark('project-list-start')
  
  // ... 프로젝트 로딩 로직
  
  performance.mark('project-list-end')
  performance.measure('project-list-duration', 'project-list-start', 'project-list-end')
  
  const measure = performance.getEntriesByName('project-list-duration')[0]
  PerformanceMonitor.recordMetric('project-list-load', measure.duration)
}
```

---

## ✅ **Definition of Done**

### **기능 요구사항**
- [ ] 8색상 팔레트를 사용한 프로젝트 생성/수정/삭제
- [ ] 드래그 앤 드롭을 통한 프로젝트 순서 변경
- [ ] 실시간 프로젝트 업데이트 동기화
- [ ] 프로젝트별 멤버 및 권한 관리
- [ ] 모바일 터치 인터페이스 지원

### **기술 요구사항**
- [ ] ShadCN UI MCP 서버 블록 사용 (dashboard-01, sidebar-02, cards-01)
- [ ] Apollo Client GraphQL 쿼리/뮤테이션/구독 구현
- [ ] Zustand 상태 관리 통합
- [ ] WebSocket 실시간 동기화
- [ ] React DnD 드래그 앤 드롭 구현

### **성능 요구사항**
- [ ] 프로젝트 목록 로딩 800ms 이하
- [ ] 드래그 앤 드롭 60fps 유지
- [ ] 색상 변경 애니메이션 150ms 이하
- [ ] 가상화를 통한 대용량 프로젝트 목록 지원

### **접근성 요구사항**
- [ ] WCAG 2.2 AA 색상 대비 4.5:1 준수
- [ ] 키보드 네비게이션 완전 지원
- [ ] 스크린 리더 ARIA 레이블 구현
- [ ] 44px 최소 터치 영역 보장

### **보안 요구사항**
- [ ] JWT 토큰 기반 인증 검증
- [ ] 프로젝트별 세분화된 권한 체크
- [ ] XSS/CSRF 방지 구현
- [ ] 민감 정보 로깅 필터링

### **테스트 요구사항**
- [ ] Jest + RTL 단위 테스트 (커버리지 80% 이상)
- [ ] Playwright E2E 테스트 (CRUD 플로우)
- [ ] jest-axe 접근성 테스트
- [ ] Lighthouse 성능 테스트 (점수 90 이상)

---

## 📚 **관련 문서 참조**

- [01. 프론트엔드 기술 스택](../ui-architecture/01-frontend-tech-stack.md)
- [04. 상태 관리](../ui-architecture/04-state-management.md)
- [05. 디자인 시스템 기초](../ui-architecture/05-design-system-foundations.md)
- [10. 보안 모범 사례](../ui-architecture/10-security-best-practices.md)
- [11. 접근성 구현](../ui-architecture/11-accessibility-implementation.md)
- [15. 실시간 WebSocket 동기화](../ui-architecture/15-realtime-websocket-sync.md)

---

## 🎯 **다음 단계**

Story 1.3 완료 후:
1. **Story 1.4**: 스케줄 CRUD 및 이벤트 관리 시스템
2. **Story 1.5**: 상태 관리 및 실시간 동기화 최적화
3. **통합 테스트**: 프로젝트-스케줄 연동 테스트

---

**이 스토리는 바로캘린더의 핵심 프로젝트 관리 기능을 완전하게 구현하기 위한 종합적인 기술 가이드입니다. 모든 UI 아키텍처 문서의 요구사항을 통합하여 실제 구현 가능한 형태로 작성되었습니다.**