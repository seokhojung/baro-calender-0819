---
# 바로캘린더 제품 요구사항 문서 (PRD) – 수정본 v1.2 (MVP)
작성일: 2025-08-11 · 작성자: Bmad FST – PO Sarah & User · 상태: Draft

> 참고: 이 문서는 섹션별 파일로 분리되었습니다. 최신 목차는 [docs/prd/README.md](./prd/README.md)를 확인하세요.

---

## 0. 변경 로그 (Change Log)
- v1.2: **필수 개선 7항 반영**
  - 계측 스키마(Event/속성) 추가 및 대시보드 운영 기준 명시
  - API 오류코드/멱등성/버전 정책 요약
  - 공유 링크 운영수치(레이트리밋·보관·폐기) 고정
  - 반복 전개(Occurrence) 운영 파라미터 표로 고정
  - 태그 모델 결정(정규화)과 p95 쿼리 예산 명시
  - (초기 단일) 멀티테넌시 대비 `tenant_id` 도입 원칙 명시
  - 개인정보/보안 최소선(보존·DSR·IP 축약) 명시
- v1.1: MVP 범위 정합성(반복/알림), KPI 가설치, 공유 링크 보안 최소선, 시간·타임존 명세, 성능 SLO 경로별 정의, 권한 모델 세분화, 리스크/오픈 이슈 보강.

---

## 1. 요약 (Executive Summary)
바로캘린더는 여러 프로젝트·스케줄을 한 눈에 조망하고 쉽게 공유하는 경량 캘린더입니다. **핵심가치: 가볍다·빠르다·한눈에 보인다.** MVP는 ‘월/주 뷰 + 필터 + 간편 공유’에 집중합니다.

---

## 2. 문제 정의 & 대상 사용자
- **문제**: 다프로젝트 일정이 분산되어 전체 타임라인 파악과 외부 공유가 번거롭다.
- **대상**: 소상공인/프리랜서/현장 매니저(인테리어 업자, 학원 강사 등).
- **핵심 니즈**: 빠른 로딩, 단순한 반복 일정, 외부에 ‘읽기’ 공유, 모바일 접근성.

---

## 3. 목표 (Goals) & KPI (가설치)
> 출시 후 3개월을 기준으로 한 초기 가설치. 데이터 관측 후 2주 내 보정.
- **MAU**: 1,000
- **DAU/MAU**: ≥ 25%
- **p95 캘린더 조회 API**: < 300ms (7일 윈도우)
- **월/주 뷰 전환(클라이언트)**: < 150ms
- **드래그-드롭 피드백(옵티컬)**: < 50ms
- **주간 사용자당 생성 일정수**: ≥ 8
- **공유 링크 생성율**: 활성 프로젝트의 ≥ 30%
- **NPS**: ≥ 40

---

## 4. 제품 범위 (Scope)
### 4.1 MVP 핵심 기능 (Core)
- **계정/인증**
- **프로젝트 CRUD**
- **캘린더 뷰**: 월/주 전환, 드롭다운 확장형 카드
 - **필터**: 전체/프로젝트별/담당자/태그(입력은 텍스트 기반 UX, 백엔드는 정규화된 태그 테이블에 저장)
- **스케줄 CRUD**
- **반복 일정(기본형)**: 매주·격주·요일 반복 + **휴무(예외) 등록**
- **공유(권한 기반)**: 멤버 초대(Owner/Editor/Commenter/Viewer), 읽기전용 링크
- **인앱 기본 알림**: 일정 시작 전 N분(기본 10분) – **댓글 알림 제외**
 - **데이터 원칙**: 초기에는 단일 테넌트로 운영하되, 모든 주요 테이블/이벤트에는 `tenant_id`를 포함해 멀티테넌시 전환을 대비한다.

### 4.2 제외 (Out of MVP)
- 고급 RRULE(매월 3번째 금요일·복수 예외 편집 등)
- 가공된 간트/타임라인 차트(월/주 뷰로 대체)
- 외부 캘린더 실시간 양방향 동기화
- 첨부파일·고급 리치텍스트
- 다크모드/테마
- **댓글 알림(푸시/이메일/멘션)**

### 4.3 Phase 2 후보
- 고급 RRULE·개별 예외 편집 UI
- 외부 캘린더(읽기→쓰기)
- 댓글 멘션/푸시/이메일
- 팀/조직 단위 역할(Owner/Manager/Member/Guest)

---

## 5. 시간·타임존·표기 규칙
- 저장은 **UTC**, 표시/입력은 클라이언트 로컬(기본 Asia/Seoul)
- 포맷: ISO-8601, 규칙: **RFC 5545(RRULE)** 준거
- **주 시작 요일**: 월요일
- **종일 일정**: 00:00~24:00, 뷰 상단에 고정
- **자정 넘김(overnight)**: `ends_at > starts_at` 보장, 캘린더는 겹침 규칙 적용
- **DST 전환일**: UTC 저장으로 일관성 유지, 표시만 로컬 규칙 적용

---

## 6. 권한 모델 (ACL)
역할: **Owner / Editor / Commenter / Viewer**

| 엔티티/행위 | Owner | Editor | Commenter | Viewer |
|---|---:|---:|---:|---:|
| 프로젝트 보기 | ✅ | ✅ | ✅ | ✅ |
| 프로젝트 편집 | ✅ | ✅ | ❌ | ❌ |
| 일정 생성/편집 | ✅ | ✅ | ❌ | ❌ |
| 댓글 작성 | ✅ | ✅ | ✅ | ❌ |
| 멤버 초대/권한 변경 | ✅ | ❌ | ❌ | ❌ |
| 읽기 링크 생성/폐기 | ✅ | ❌ | ❌ | ❌ |

---

## 7. 공유 링크 보안·운영 정책 (MVP 최소선)
- **토큰**: 128비트 이상 랜덤, URL-safe, **원문 미저장**(DB에는 `token_hash`만 저장)
- **만료**: 기본 7일(옵션: 24시간/30일)
- **해지**: Owner가 언제든 폐기 가능(일괄 폐기 지원)
- **접근 로그**: 최근 **30일** 조회(시간/접속 IP 대역, /24 등 축약 저장)
- **레이트리밋**: 토큰·IP 별 **60 rpm**, 초과 시 **429**(Retry-After 포함)
- **도메인 제한(옵션)**: `*.corp.example` 허용 리스트

---

## 8. 성능 SLO + 전개 파라미터
### 8.1 경로별 SLO
| 경로 | 목표(p95) | 비고 |
|---|---:|---|
| 월↔주 뷰 전환(TTI) | < 150ms | 사전 전개 + 가상 스크롤 |
| 드래그-드롭 피드백 | < 50ms | 옵티컬 피드백 우선 |
| 타임라인 조회 API | < 300ms | 기간쿼리 + 인덱스 |
| 태그 검색 API | < 100ms | `event_tags(tag)` 인덱스, 캐시 TTL 60s |
| 로그인→첫 화면 | < 1.0s | 캐시/스켈레톤 |

### 8.2 Occurrence 전개(운영값)
| 항목 | 값 |
|---|---|
| 조회 윈도우 | 기본 **±90일** |
| 전개 방식 | 하이브리드(materialize) |
| 워커 동시성 | 4 (초기) |
| 재시도/백오프 | 최대 5회, 지수(1s→2s→4s→…) |
| 재전개 트리거 | 이벤트 생성/수정/삭제, TZ 변경, 윈도우 만료 |
| 목표 p95 | **1k occurrence 당 ≤ 400ms** |
| 모니터링 | 전개 지연·실패율 대시보드/알람 |


### 8.3 복구 목표 (RPO/RTO)
- **RPO (Recovery Point Objective)**: 24시간 – 장애 발생 시 최대 하루 전 시점까지 데이터 복구 가능
- **RTO (Recovery Time Objective)**: 4시간 – 장애 복구 개시 후 4시간 이내 서비스 정상화
- 운영 기준은 아키텍처 문서 11항 ‘백업·복구·운영’을 따른다.

---

## 9. 요구사항 상세 (요약)
- **검색/필터**: 텍스트 태그, 담당자, 프로젝트 멀티 선택
- **편집 UX**: 더블클릭 생성, 드래그 이동/리사이즈, ESC 취소
- **접근성**: WCAG 2.2 AA 지향, 키보드 포커스·SR 라벨 표준, 모바일 롱프레스 **300ms**
- **모바일 우선**: 터치 드래그/롱프레스, 반응형

---

## 10. 검증/측정 계획 (Analytics)
### 10.1 이벤트 스키마(공통 속성)
공통: `tenant_id, user_id, project_id, tz, viewport_from, viewport_to, device, country, cold_start(bool)`

### 10.2 핵심 이벤트
| 이벤트 | 설명 |
|---|---|
| `view_switch` | 월↔주 전환 발생 |
| `timeline_query` | `/timeline` 기간 조회 |
| `event_create` / `event_update` / `event_delete` | 스케줄 CRUD |
| `recurrence_save` | 반복 규칙 저장 |
| `share_link_create` / `share_link_open` | 공유 생성/열람 |
| `auth_login` | 로그인 성공 |

### 10.3 대시보드·운영
- 리포트: **주간**(PO/팀), p95 API·TTI·전개지연, 링크 열람/생성률, DAU/MAU.
- 데이터 보존: 원시 이벤트 **90일**(대시보드 집계는 장기).

---

> **아키텍처 연계**: Analytics 이벤트 수집은 API 계층에서 스키마(tenant_id, user_id 등)를 로깅하고, 메시지 큐를 통해 ETL/데이터 웨어하우스로 전달한다. 로그 보존은 90일, 주요 대시보드 지표(p95 API, 전개 지연 등)는 아키텍처 문서 9항 ‘관측성’ 기준을 따른다.

## 11. API 계약 요약 (제품 관점)
- **버전**: `/v1` 경로 고정(차기 버전은 `/v2`), `Sunset` 헤더로 폐기 예고.
- **오류코드**: 400/401/403/404/409/410/422/429/500 사용, 본문에 `code/message` 제공.
- **멱등성**: `POST /events`, `POST /share-links` 요청에 **Idempotency-Key** 헤더 지원(24h 캐시).
 - **태그 필터**: `tags` 파라미터는 사용자가 입력한 텍스트를 정규화한 태그와 매칭해 검색한다.

---

## 12. 리스크 & 대응
- **반복 전개 성능**: 하이브리드 전개 + 윈도우/인덱스 + 워커 모니터링
- **링크 유출**: 만료·폐기·로그·레이트리밋
- **모바일 DnD 난이도**: 롱프레스 + 스냅/가이드라인 제공

---

## 13. 수용 기준 (AC) – 샘플
- **월→주 전환**: p95 TTI ≤ 150ms, 스켈레톤 ≤ 50ms 이내 노출.
- **반복 저장 정확도**: Asia/Seoul 기준 3개월 창에서 누락/중복 0건.
- **공유 만료 처리**: 8일차 접속 시 410 Gone + 재생성 CTA.

---

## 14. 오픈 이슈
- 공유 링크 도메인 제한 기본값(Off/On?)
- 댓글 보관정책(Phase 2에서)

---

## 15. 기술 스택 (Technology Stack)

### 15.1 프론트엔드
- **프레임워크**: Next.js 15.4.6
- **언어**: TypeScript
- **UI 라이브러리**: shadcn/ui + tweakcn
- **스타일링**: Tailwind CSS
- **상태 관리**: React Context API / Zustand
- **애니메이션**: Framer Motion
- **접근성**: WCAG 2.2 AA 준수

### 15.2 백엔드
- **프레임워크**: Fastify
- **데이터베이스**: PostgreSQL
- **인증**: JWT + ACL
- **로깅**: Winston
- **API 문서**: Swagger/OpenAPI

### 15.3 개발 도구
- **패키지 관리**: npm
- **개발 서버**: nodemon
- **테스트**: Jest
- **코드 품질**: ESLint

---

## 16. UI/UX 구현 전략

### 16.1 shadcn/ui 활용 방안
- **컴포넌트 기반 아키텍처**: 재사용 가능한 UI 컴포넌트 라이브러리 구축
- **일관된 디자인**: 모든 화면에서 통일된 디자인 시스템 적용
- **접근성 우선**: WCAG 2.2 AA 기준을 만족하는 컴포넌트 활용
- **성능 최적화**: React.memo, useMemo, useCallback을 활용한 렌더링 최적화

### 16.2 tweakcn 테마 시스템
- **프로젝트별 색상**: 각 프로젝트마다 고유한 색상 테마 적용
- **동적 테마 변경**: 사용자 설정에 따른 테마 전환 지원
- **색상 팔레트**: 일관된 색상 체계로 시각적 구분 강화
- **다크모드 준비**: 향후 다크모드 지원을 위한 기본 구조 구축

### 16.3 성능 최적화 전략
- **번들 최적화**: Tree Shaking과 코드 스플리팅으로 초기 로딩 시간 단축
- **지연 로딩**: 필요시에만 컴포넌트를 로드하여 메모리 사용량 최적화
- **CSS 최적화**: Tailwind CSS 클래스 최적화로 렌더링 성능 향상
- **애니메이션 최적화**: CSS 하드웨어 가속을 활용한 부드러운 전환 효과

---

> **아키텍처 연계**: Analytics 이벤트 수집은 API 계층에서 스키마(tenant_id, user_id 등)를 로깅하고, 메시지 큐를 통해 ETL/데이터 웨어하우스로 전달한다. 로그 보존은 90일, 주요 대시보드 지표(p95 API, 전개 지연 등)는 아키텍처 문서 9항 '관측성' 기준을 따른다.
